# Default values for rustatio.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# -- Number of replicas (should typically be 1)
replicaCount: 1

image:
  # -- Repository for the Rustatio image
  repository: ghcr.io/takitsu21/rustatio
  # -- Image pull policy
  pullPolicy: IfNotPresent
  # -- Image tag (defaults to chart appVersion if not set)
  tag: ""

# -- Image pull secrets
imagePullSecrets: []

# -- Override the chart name
nameOverride: ""

# -- Override the full name
fullnameOverride: ""

serviceAccount:
  # -- Specifies whether a service account should be created
  create: true
  # -- Annotations to add to the service account
  annotations: {}
  # -- The name of the service account to use
  name: ""
  rbac:
    # -- Create RBAC resources for the service account
    create: false

# -- Pod annotations
podAnnotations: {}

# -- Pod labels
podLabels: {}

# -- Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

# -- Security context for the container
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  seccompProfile:
    type: RuntimeDefault

service:
  # -- Service type
  type: ClusterIP
  # -- Service port
  port: 8080
  # -- Target port in the container
  targetPort: 8080
  # -- Service annotations
  annotations: {}

# -- Node selector
nodeSelector: {}

# -- Tolerations
tolerations: []

# -- Affinity rules
affinity: {}

# -- Topology spread constraints
topologySpreadConstraints: []

# -- Resources
resources:
  limits:
    cpu: 500m
    memory: 256Mi
  requests:
    cpu: 100m
    memory: 128Mi

# -- Configure extra environment variables
extraEnvVars: []
#  - name: CUSTOM_VAR
#    value: "custom-value"

# -- Configure extra volume mounts
extraVolumeMounts: []
#  - name: extra-config
#    mountPath: /etc/rustatio/extra

# -- Configure extra volumes
extraVolumes: []
#  - name: extra-config
#    configMap:
#      name: extra-config

# Authentication configuration
auth:
  # -- Enable authentication
  enabled: false
  # -- Authentication token (generate with: openssl rand -hex 32)
  # If not set and auth.enabled is true, a random token will be generated
  token: ""
  # -- Use an existing secret for the AUTH_TOKEN
  existingSecret: ""
  # -- Key in the secret containing the token
  existingSecretKey: "AUTH_TOKEN" # pragma: allowlist secret

# Logging configuration
logging:
  # -- Rust log level (trace, debug, info, warn, error)
  level: "info"

# -- User ID for file permissions (PUID)
puid: 1000

# -- Group ID for file permissions (PGID)
pgid: 1000

# Watch folder configuration
watch:
  # -- Enable watch folder
  enabled: false
  # -- Auto-start faking new torrents found in the watch folder
  autoStart: false
  # -- Path inside the container for torrents
  path: /torrents

# Persistence configuration
persistence:
  # Data persistence for Rustatio state
  data:
    # -- Enable persistent storage for data
    enabled: true
    # -- Storage class for the PVC
    storageClass: ""
    # -- Access mode for the PVC
    accessMode: ReadWriteOnce
    # -- Size of the PVC
    size: 1Gi
    # -- Use an existing PVC
    existingClaim: ""
    # -- Annotations for the PVC
    annotations: {}
    # -- Retain the PVC when the release is deleted
    retain: true

  # Torrents watch folder persistence
  torrents:
    # -- Enable persistent storage for torrents
    enabled: false
    # -- Storage class for the PVC
    storageClass: ""
    # -- Access mode for the PVC
    accessMode: ReadWriteOnce
    # -- Size of the PVC
    size: 5Gi
    # -- Use an existing PVC
    existingClaim: ""
    # -- Annotations for the PVC
    annotations: {}
    # -- Retain the PVC when the release is deleted
    retain: true

# Ingress configuration
ingress:
  # -- Enable ingress
  enabled: false
  # -- Ingress class name
  className: ""
  # -- Ingress annotations
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
  # -- Ingress hosts
  hosts:
    - host: rustatio.local
      paths:
        - path: /
          pathType: Prefix
  # -- TLS configuration
  tls: []
  #  - secretName: rustatio-tls
  #    hosts:
  #      - rustatio.local

# VPN configuration using gluetun sidecar
vpn:
  # -- Enable VPN routing for tracker requests
  enabled: false
  gluetun:
    # -- Enable gluetun VPN sidecar
    enabled: true
    # -- Repository for the gluetun image
    repository: qmcgaw/gluetun
    # -- Image tag
    tag: latest
    # -- Image pull policy
    pullPolicy: IfNotPresent
    # -- Environment variables for gluetun configuration
    # See https://github.com/qdm12/gluetun-wiki for provider-specific settings
    env: []
      # - name: VPN_SERVICE_PROVIDER
      #   value: "protonvpn"
      # - name: VPN_TYPE
      #   value: "wireguard"
      # - name: WIREGUARD_PRIVATE_KEY
      #   valueFrom:
      #     secretKeyRef:
      #       name: vpn-credentials
      #       key: private-key
      # - name: SERVER_COUNTRIES
      #   value: "Switzerland"
    # -- Environment variables from secrets/configmaps
    envFrom: []
    # -- Extra volume mounts for gluetun
    extraVolumeMounts: []
    # -- Security context for gluetun (requires NET_ADMIN capability)
    securityContext:
      capabilities:
        add:
          - NET_ADMIN
    # -- Resources for gluetun container
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
      requests:
        cpu: 100m
        memory: 128Mi

# -- Liveness probe configuration
livenessProbe:
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# -- Readiness probe configuration
readinessProbe:
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# -- Startup probe configuration
startupProbe:
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 30
